/**
 * copyright: Olivier Combe (https://github.com/ocombe/angular-localForage)
 */
(function(e,t,n){"use strict";var r=t.module("LocalForageModule",["ng"]);r.provider("$localForage",function(){this.prefix="lf";this.notify={setItem:false,removeItem:false};this.setPrefix=function(e){this.prefix=e};var e=function(e){return localforage.setDriver(e)};this.setDriver=e;var n=function(){return localforage.driver};this.setNotify=function(e,t){this.notify={setItem:e,removeItem:t}};this.$get=["$rootScope","$q","$parse",function(r,i,s){var o=this.prefix;var u=this.notify;var a={};if(o.substr(-1)!=="."){o=!!o?o+".":""}var f=function(e,t){var n=i.defer();localforage.setItem(o+e,t).then(function(){if(u.setItem){r.$broadcast("LocalForageModule.setItem",{key:e,newvalue:t,driver:localforage.driver})}n.resolve()});return n.promise};var l=function(e){var t=i.defer();localforage.getItem(o+e).then(function(e){t.resolve(e)});return t.promise};var c=function(e){var t=localforage.removeItem(e);if(u.setItem){return t.then(function(t){r.$broadcast("LocalForageModule.removeItem",{key:e,driver:localforage.driver})})}else{return t}};var h=function(){var e=i.defer();var n=[];v().then(function(r){t.forEach(r,function(e){n.push(c(e))});i.all(n).then(function(){e.resolve()})});return e.promise};var p=function(e){var t=i.defer();localforage.key(e).then(function(e){t.resolve(e)});return t.promise};var d=function(){var e=i.defer();return localforage.length().then(function(t){e.resolve(t)});return e.promise};var v=function(){var e=i.defer();d().then(function(t){var n=[],r=[];for(var s=0;s<t;s++){n.push(p(s).then(function(e){if(e.indexOf(o)===0){r.push(e)}}))}i.all(n).then(function(){e.resolve(r)})});return e.promise};var m=function(e,n){if(t.isString(n)){n={key:n}}else if(!t.isObject(n)||t.isUndefined(n.key)){throw"You must defined a key to bind"}var r={defaultValue:"",storeName:""};n=t.extend(r,n||{});var i=n.storeName||n.key,o=s(n.key);return l(i).then(function(r){if(r){o.assign(e,r)}else if(n.defaultValue){f(i,n.defaultValue)}if(t.isDefined(a[n.key])){a[n.key]()}a[n.key]=e.$watch(s(n.key),function(e){if(t.isDefined(e)){f(i,e)}},true)})};var g=function(e,n,r){r=r||n;s(n).assign(e,null);if(t.isDefined(a[n])){a[n]();delete a[n]}c(r)};return{setDriver:e,getDriver:n,set:f,get:l,remove:c,clearAll:h,getKeyAt:p,getKeys:v,getLength:d,bind:m,unbind:g}}]});r.directive("localForage",["$localForage",function(e){return{restrict:"A",link:function(n,r,i){var s=n.$eval(i.localForage);if(t.isObject(s)&&t.isDefined(s.key)&&t.isDefined(s.storeName)){e.bind(n,s)}else{e.bind(n,i.localForage)}}}}])})(window,window.angular)